# Noridoc: plugin

Path: @/plugin

### Overview

Claude Code plugin package providing comprehensive integration with the Nori Profiles system through a directory-based profile system. Each profile is a complete, self-contained configuration with its own CLAUDE.md instructions, skills, subagents, and slash commands. The installer CLI manages profile installation and switching, while backend API tools enable paid tier knowledge management features.

### How it fits into the larger codebase

This package is a complete Claude Code plugin that installs multiple components to enhance Claude's capabilities. The nori-ai installer CLI (defined in @/plugin/package.json bin) prompts users to select a profile, then installs that profile's complete configuration to ~/.claude/. The CLI supports a `--agent` flag for multi-agent targeting (default: "claude-code"). Profiles are stored in @/plugin/src/cli/agents/claude/profiles/config/ as directory structures with mixins for composition. Built-in profiles include senior-swe (default) and amol. The profilesLoader composes profiles from mixins and copies them to ~/.claude/profiles/ (making it the source of truth for future installs). CLAUDE.md is generated by combining the profile's base instructions with a dynamically-generated skills list. For paid tier users, profiles can include paid skills that communicate with @/server via the API client in @/plugin/src/api.

### Core Implementation

The src directory contains three main areas: cli (CLI with multi-agent support and feature loaders), api (backend client for paid features), and providers (shared authentication providers like Firebase). The package.json defines the nori-ai bin executable that runs the CLI. The build process (scripts/build.sh) compiles TypeScript, copies profile directories from `src/cli/agents/claude/` (CRITICAL: must mkdir -p and cp config directories or installer fails with ENOENT), sets permissions, and injects version strings. The installer flow: (1) display banner and prompt for credentials, (2) determine install mode (free/paid) from credentials, (3) run profilesLoader to compose and copy profiles to ~/.claude/profiles/, (4) prompt for profile selection, (5) save config with selected profile name to ~/nori-config.json. The profilesLoader composes profiles from mixins at @/plugin/src/cli/agents/claude/profiles/config/_mixins/ and copies them to ~/.claude/profiles/, making ~/.claude/profiles/ the single source of truth. CLAUDE.md generation includes dynamically-generated skills lists by globbing for SKILL.md files and extracting frontmatter metadata. The statusline loader installs a bash script that displays git branch, profile name (from ~/nori-config.json), token usage, cost, and Nori branding.

### Things to Know

The package is published to npm as nori-ai and installed globally. The directory-based profile system replaced the old JSON-based preference customization system in PR #197, deleting 8,296 lines including base-instructions.md and all preference-based CLAUDE.md generation. Profiles are now complete, self-contained configurations that can be copied and modified by users. The installer is idempotent - re-running it updates built-in profiles but preserves custom user profiles. Profile switching via `npx nori-ai@latest switch-profile` or `/nori-switch-profile` slash command preserves auth credentials while updating the selected profile, then re-runs installation non-interactively. The profile architecture fix in commit 70da534 made ~/.claude/profiles/ the source of truth - all feature loaders now read from there instead of the npx package location, enabling users to create and modify custom profiles. Skills are discovered at installation time via glob pattern \*\*/SKILL.md, so adding new skills to a profile requires re-running installation to regenerate the CLAUDE.md skills list. Paid skills (paid-memorize, paid-recall, paid-read-noridoc, paid-write-noridoc, paid-list-noridocs, paid-prompt-analysis) are bundled TypeScript executables that call @/plugin/src/api methods which connect to @/server endpoints. The API client uses Firebase authentication via @/plugin/src/providers/firebase.ts, which provides a singleton FirebaseProvider for credential management and token caching. The statusline displays the active profile name (added in commit 5da74b7) alongside git branch, cost, and token metrics. Changes to CLAUDE.md take effect in new conversations without requiring a Claude Code restart, but profile switching triggers a restart to fully reload the configuration. The plugin architecture enables modular installation where free users get local workflow enhancements while paid users additionally get backend integration for knowledge persistence and retrieval.
