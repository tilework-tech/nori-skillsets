# Noridoc: plugin

Path: @/

### Overview

Claude Code plugin package providing comprehensive integration with the Nori Profiles system through a directory-based profile system. Each profile is a complete, self-contained configuration with its own CLAUDE.md instructions, skills, subagents, and slash commands. The installer CLI manages profile installation and switching, while backend API tools enable knowledge management features for authenticated users.

### How it fits into the larger codebase

This package is a complete Claude Code plugin that installs multiple components to enhance Claude's capabilities. The nori-skillsets CLI (defined in @/package.json bin) prompts users to select a profile, then installs that profile's complete configuration to ~/.claude/. The package does not ship any built-in profiles -- profiles are obtained from the registry or created by users. User-installed profiles are stored in `~/.nori/profiles/` (the single source of truth). Feature loaders read from `~/.nori/profiles/` to install skills to ~/.claude/skills/, subagents to ~/.claude/subagents/, slash commands to ~/.claude/slash-commands/, and generate CLAUDE.md by combining the profile's base instructions with a dynamically-generated skills list. For authenticated users, profiles can include skills that communicate with @/server via the API client in @/src/api.

### Core Implementation

The src directory contains three main areas: installer (CLI for installation and feature loaders), api (backend client for server communication), and providers (shared authentication providers like Firebase). The package.json defines the nori-skillsets bin executable that runs the installer. The build process (@/scripts/build.sh) compiles TypeScript, sets permissions, and injects version strings. The publish process uses an interactive prepublish script (@/scripts/prepublish.sh) that prompts the user whether to generate release notes; if yes, it invokes Claude Code headless CLI (`claude -p`) to analyze git commits since the last version tag and update @/release-notes.txt following instructions in @/release-notes-update.md, then prompts whether to commit the changes (declining aborts publish with exit 1). The installer flow: (1) init to set up directories and capture existing config, (2) resolve profile from --profile flag or existing config and save merged config, (3) run feature loaders to install components. The profiles loader (runs first) ensures `~/.nori/profiles/` exists and configures permissions -- it does not copy any built-in profiles since the package ships none. The claudemd loader reads the selected profile's CLAUDE.md, generates a skills list by globbing the profile's skills/ directory for SKILL.md files, extracts frontmatter metadata (name, description) from each skill, and embeds the complete skills list in the managed block. The skills, subagents, and slashcommands loaders copy files from `~/.nori/profiles/{profileName}/{skills|subagents|slashcommands}/` to their respective `~/.claude/` installation directories. The statusline loader installs a bash script that displays git branch, profile name (from ~/nori-config.json), token usage, cost, and Nori branding.

The `nori-skillsets` npm package is published via @/scripts/package_skillsets.sh which uses a curated subset of runtime dependencies (listed in @/packages/nori-skillsets/dependencies.json) rather than the full dependency tree. The packaging script copies the compiled `build/` directory into a staging area, generates a `package.json` from the template at @/packages/nori-skillsets/ plus dependency versions from the main @/package.json, and produces a tarball. Releases are managed by @/scripts/create_skillsets_release.py which pushes git tags to trigger the CI workflow.

Testing infrastructure includes unit tests in @/tests (Vitest-based, run on every commit) and integration tests in @/nori-tests (markdown specifications executed by external nori-tests CLI in Docker, run selectively pre-release).

### Things to Know

The package is published to npm as nori-skillsets and installed globally. The directory-based profile system replaced the old JSON-based preference customization system. Profiles are complete, self-contained configurations that can be modified by users. The package does not ship any built-in profiles -- users obtain profiles from the registry or create their own. Profile switching via `npx nori-skillsets switch-skillset` or `/nori-switch-profile` slash command preserves auth credentials while updating the selected profile, then re-runs installation non-interactively. All feature loaders read from `~/.nori/profiles/` as the single source of truth, enabling users to create and modify custom profiles. Skills are discovered at installation time via glob pattern \*\*/SKILL.md, so adding new skills to a profile requires re-running installation to regenerate the CLAUDE.md skills list. The memorize and recall skills are bundled TypeScript executables that call @/src/api methods which connect to @/server endpoints. The API client uses Firebase authentication via @/src/providers/firebase.ts, which provides a singleton FirebaseProvider for credential management and token caching. The statusline displays the active profile name (added in commit 5da74b7) alongside git branch, cost, and token metrics. Changes to CLAUDE.md take effect in new conversations without requiring a Claude Code restart, but profile switching triggers a restart to fully reload the configuration. The plugin architecture enables modular installation where all users get local workflow enhancements and authenticated users additionally get backend integration for knowledge persistence and retrieval. The prepublishOnly hook (@/scripts/prepublish.sh) runs only on `npm publish` (not on `npm install`) and is interactive - it prompts whether to generate release notes (using Claude headless mode if yes), then prompts whether to commit the changes (aborting publish if declined); this requires a tty and cannot run headlessly in CI. The `nori-skillsets` CLI uses static imports throughout, so all third-party dependencies in its import chain must be declared in @/packages/nori-skillsets/dependencies.json or the CLI will crash at load time with `ERR_MODULE_NOT_FOUND` -- even for commands that are never invoked.

Created and maintained by Nori.
