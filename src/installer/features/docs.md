# Noridoc: features

Path: @/plugin/src/installer/features

### Overview

Feature loader registry and individual feature implementations for installing Nori components into Claude Code. Uses a directory-based profile system where each profile contains complete configurations for CLAUDE.md, skills, subagents, and slash commands. Contains loaders for: config, skills, claudemd, hooks, profiles, slashcommands, statusline, and subagents.

### How it fits into the larger codebase

This folder contains the modular installer architecture where each feature is a loader that installs a specific component. The LoaderRegistry (@/plugin/src/installer/features/loaderRegistry.ts) manages all feature loaders (config, skills, claudemd, hooks, profiles, slashcommands, statusline, subagents) and executes them sequentially during installation by @/plugin/src/installer/install.ts. The configLoader (@/plugin/src/installer/features/config/loader.ts) is the single point of config persistence during installation - it saves the Config to `.nori-config.json` including auth credentials, profile selection, and user preferences. Each loader implements the Loader interface with run(), uninstall(), and validate() methods. The unified Config type from @/plugin/src/installer/config.ts contains auth credentials (optional), profile.baseProfile (string name like 'senior-swe', 'amol', 'nontechnical'), user preferences, and installDir. Paid vs free installation is determined by calling `isPaidInstall({ config })` which checks if `config.auth != null`. All feature loaders load their content from the selected profile directory at profiles/config/{profileName}/. The claudemd loader reads CLAUDE.md directly from the profile directory and generates a skills list by discovering SKILL.md files. The skills, slashcommands, and subagents loaders copy files from their respective profile subdirectories. The profiles loader copies all profile directories to ~/.claude/profiles/ for profile switching via the /nori-switch-profile slash command. Free mode installs claudemd, skills, slashcommands, statusline, and profiles. Paid mode additionally installs hooks and subagents.

### Core Implementation

Each loader implements run(config) to install, uninstall(config) to remove, and validate(config) to check installation state. Loaders use getConfigDir({ profileName }) helpers to construct paths to profile-specific config directories. The claudemd loader reads profiles/config/{profileName}/CLAUDE.md, appends a dynamically-generated skills list (by globbing for SKILL.md files and extracting frontmatter), and inserts into ~/.claude/CLAUDE.md within BEGIN/END NORI-AI MANAGED BLOCK markers. The skills loader copies from profiles/config/{profileName}/skills/ to {{skills_dir}}/, stripping the 'paid-' prefix from paid skills and only installing them in paid mode. The slashcommands loader copies .md files (excluding docs.md) from profiles/config/{profileName}/slashcommands/ to ~/.claude/commands/, applying template substitution via substituteTemplatePaths() to replace placeholders like `{{profiles_dir}}` with actual paths. The subagents loader copies .md files (excluding docs.md) from profiles/config/{profileName}/subagents/ to ~/.claude/agents/. The profiles loader copies all profile directories from profiles/config/ to ~/.claude/profiles/, verifying each has a CLAUDE.md file. Profile switching is handled by the /nori-switch-profile slash command (or npx nori-ai switch-profile CLI command) which updates nori-config.json and re-runs installation to apply the new profile. The statusline loader installs a bash script to display profile name in the terminal prompt. All loaders use fs/promises for async file operations and utilities from @/plugin/src/installer for logging. Installation is sequential to avoid race conditions.

The LoaderRegistry provides two methods for retrieving loaders: getAll() returns loaders in registration order (profiles first), and getAllReversed() returns loaders in reverse order (profiles last). The install process uses getAll() because profiles must run first to create profile directories that other loaders read from. The uninstall process uses getAllReversed() because slashcommands and subagents loaders need to read from profile directories to know which files to remove before the profiles loader deletes those directories. This ordering invariant is critical - without it, uninstall fails to clean up files because loaders can't find their source directories.

### Things to Know

Profile structure is now directory-based rather than JSON-based. Each profile directory (senior-swe, amol, nontechnical) contains CLAUDE.md, skills/, subagents/, slashcommands/, and optionally PROFILE.md. The major change in #197 removed preference-based CLAUDE.md customization (base-instructions.md with CUSTOMIZABLE markers) in favor of complete per-profile CLAUDE.md files. Skills list generation happens at install time, not at profile creation time. Paid skills use a 'paid-' prefix in the profile's skills/ directory but are installed without the prefix (e.g., paid-recall/ becomes the skills directory's recall/). The switch-nori-profile command updates nori-config.json and re-runs installation to apply the new profile. The managed block pattern allows users to add custom instructions outside the block without losing them during reinstalls. Default profile is 'senior-swe'. Running install multiple times is idempotent and regenerates all installed files from the selected profile. Most changes require Claude Code restart except CLAUDE.md which applies to new conversations immediately. Source markdown files use template placeholders (`{{skills_dir}}`, `{{profiles_dir}}`, etc.) that are substituted during installation to support configurable installation directories - home installs get tilde notation paths while custom installs get absolute paths.
